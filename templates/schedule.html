{% extends 'base.html' %}

{% block content %}
<h1 class="mb-4">Schedule Management</h1>

<!-- Staff Selector -->
<div class="card mb-4">
    <div class="card-body">
        <form id="staff-selector" class="row g-3">
            <div class="col-md-4">
                <label for="staff_id" class="form-label">Select Staff Member</label>
                <select class="form-select" id="staff_id" name="staff_id">
                    <option value="">-- Select Staff --</option>
                    <option value="1">Dr. John Smith</option>
                    <option value="2">Dr. Jane Johnson</option>
                    <option value="3">Dr. Michael Brown</option>
                    <option value="4">Dr. Emily Davis</option>
                    <option value="5">Dr. Robert White</option>
                </select>
            </div>
            <div class="col-md-2 d-flex align-items-end">
                <button type="submit" class="btn btn-primary">Load Schedule</button>
            </div>
        </form>
    </div>
</div>

<!-- Weekly Schedule -->
<div class="card" id="schedule-card" style="display: none;">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">Weekly Schedule</h5>
        <div class="btn-group">
            <button class="btn btn-outline-primary" id="apply-default">
                <i class="fas fa-sync me-1"></i> Apply Default Schedule
            </button>
            <button class="btn btn-outline-primary" id="bulk-update">
                <i class="fas fa-edit me-1"></i> Bulk Update
            </button>
        </div>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Day</th>
                        <th>Working Day</th>
                        <th>Start Time</th>
                        <th>End Time</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="schedule-body">
                    <!-- Will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Time Slot Editor Modal -->
<div class="modal fade" id="timeslotModal" tabindex="-1" aria-labelledby="timeslotModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="timeslotModalLabel">Edit Time Slot</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="timeslot-form">
                    <input type="hidden" id="weekday" name="weekday">
                    <input type="hidden" id="selected-staff-id" name="staff_id">
                    
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="is_working_day" name="is_working_day">
                        <label class="form-check-label" for="is_working_day">Working Day</label>
                    </div>
                    
                    <div class="mb-3">
                        <label for="start_time" class="form-label">Start Time</label>
                        <input type="time" class="form-control" id="start_time" name="start_time">
                    </div>
                    
                    <div class="mb-3">
                        <label for="end_time" class="form-label">End Time</label>
                        <input type="time" class="form-control" id="end_time" name="end_time">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="save-timeslot">Save</button>
            </div>
        </div>
    </div>
</div>

<!-- Bulk Update Modal -->
<div class="modal fade" id="bulkModal" tabindex="-1" aria-labelledby="bulkModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="bulkModalLabel">Bulk Update Schedule</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="bulk-form">
                    <input type="hidden" id="bulk-staff-id" name="staff_id">
                    
                    <div class="mb-3">
                        <label class="form-label">Working Days</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="monday" name="weekdays" value="0" checked>
                            <label class="form-check-label" for="monday">Monday</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="tuesday" name="weekdays" value="1" checked>
                            <label class="form-check-label" for="tuesday">Tuesday</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="wednesday" name="weekdays" value="2" checked>
                            <label class="form-check-label" for="wednesday">Wednesday</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="thursday" name="weekdays" value="3" checked>
                            <label class="form-check-label" for="thursday">Thursday</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="friday" name="weekdays" value="4" checked>
                            <label class="form-check-label" for="friday">Friday</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="saturday" name="weekdays" value="5">
                            <label class="form-check-label" for="saturday">Saturday</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="sunday" name="weekdays" value="6">
                            <label class="form-check-label" for="sunday">Sunday</label>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="bulk_start_time" class="form-label">Start Time</label>
                        <input type="time" class="form-control" id="bulk_start_time" name="start_time" value="09:00">
                    </div>
                    
                    <div class="mb-3">
                        <label for="bulk_end_time" class="form-label">End Time</label>
                        <input type="time" class="form-control" id="bulk_end_time" name="end_time" value="17:00">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="save-bulk">Save</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const dayNames = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
    let timeslotModal, bulkModal;
    
    // Initialize modals
    timeslotModal = new bootstrap.Modal(document.getElementById('timeslotModal'));
    bulkModal = new bootstrap.Modal(document.getElementById('bulkModal'));
    
    // Staff selector form
    document.getElementById('staff-selector').addEventListener('submit', function(e) {
        e.preventDefault();
        const staffId = document.getElementById('staff_id').value;
        
        if (!staffId) {
            alert('Please select a staff member');
            return;
        }
        
        // Show schedule card
        document.getElementById('schedule-card').style.display = 'block';
        
        // Set hidden staff ID fields
        document.getElementById('selected-staff-id').value = staffId;
        document.getElementById('bulk-staff-id').value = staffId;
        
        // Load schedule for this staff
        loadSchedule(staffId);
    });
    
    // Load schedule data
    function loadSchedule(staffId) {
        // In a real app, this would fetch data from the server
        // For now, we'll use sample data
        
        const scheduleBody = document.getElementById('schedule-body');
        scheduleBody.innerHTML = '';
        
        // Sample schedule data
        const scheduleData = [
            { weekday: 0, working: true, start_time: '09:00', end_time: '17:00' },
            { weekday: 1, working: true, start_time: '09:00', end_time: '17:00' },
            { weekday: 2, working: true, start_time: '09:00', end_time: '17:00' },
            { weekday: 3, working: true, start_time: '09:00', end_time: '17:00' },
            { weekday: 4, working: true, start_time: '09:00', end_time: '17:00' },
            { weekday: 5, working: false, start_time: '', end_time: '' },
            { weekday: 6, working: false, start_time: '', end_time: '' }
        ];
        
        // Create table rows
        scheduleData.forEach(day => {
            const row = document.createElement('tr');
            
            row.innerHTML = `
                <td>${dayNames[day.weekday]}</td>
                <td>
                    <span class="badge ${day.working ? 'bg-success' : 'bg-danger'}">
                        ${day.working ? 'Yes' : 'No'}
                    </span>
                </td>
                <td>${day.working ? day.start_time : '-'}</td>
                <td>${day.working ? day.end_time : '-'}</td>
                <td>
                    <button class="btn btn-sm btn-primary edit-btn" data-weekday="${day.weekday}">
                        <i class="fas fa-edit"></i> Edit
                    </button>
                </td>
            `;
            
            scheduleBody.appendChild(row);
        });
        
        // Add event listeners for edit buttons
        document.querySelectorAll('.edit-btn').forEach(button => {
            button.addEventListener('click', function() {
                const weekday = this.getAttribute('data-weekday');
                const dayData = scheduleData[weekday];
                
                // Populate modal form
                document.getElementById('weekday').value = weekday;
                document.getElementById('is_working_day').checked = dayData.working;
                document.getElementById('start_time').value = dayData.start_time;
                document.getElementById('end_time').value = dayData.end_time;
                
                // Show modal
                timeslotModal.show();
            });
        });
    }
    
    // Save time slot
    document.getElementById('save-timeslot').addEventListener('click', function() {
        // In a real app, this would send data to the server
        alert('Schedule updated! This would save to the database in a real application.');
        timeslotModal.hide();
    });
    
    // Bulk update button
    document.getElementById('bulk-update').addEventListener('click', function() {
        bulkModal.show();
    });
    
    // Save bulk update
    document.getElementById('save-bulk').addEventListener('click', function() {
        // In a real app, this would send data to the server
        alert('Bulk update applied! This would save to the database in a real application.');
        bulkModal.hide();
    });
    
    // Apply default schedule
    document.getElementById('apply-default').addEventListener('click', function() {
        if (confirm('Are you sure you want to apply the default schedule? This will overwrite the current schedule.')) {
            // In a real app, this would apply default schedule
            alert('Default schedule applied! This would save to the database in a real application.');
            
            // Reload schedule
            const staffId = document.getElementById('selected-staff-id').value;
            loadSchedule(staffId);
        }
    });
});
</script>
{% endblock %}